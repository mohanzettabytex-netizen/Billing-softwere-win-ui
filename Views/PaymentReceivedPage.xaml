<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="App_3.Views.PaymentReceivedPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:App_3.Models"
    xmlns:conv="using:App_3.Converters"
    Background="#F3F4F6">

    <!-- RESOURCES -->
    <Page.Resources>
        <conv:PaymentStatusToColorConverter x:Key="StatusBg"/>
        <conv:PaymentStatusToForegroundConverter x:Key="StatusFg"/>
    </Page.Resources>

    <!-- ROOT GRID (IMPORTANT) -->
    <Grid>

        <!-- ================= MAIN CONTENT ================= -->
        <ScrollViewer>
            <StackPanel Padding="24" Spacing="20">

                <!-- HEADER -->
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <StackPanel>
                        <TextBlock Text="Payments Received"
                                   FontSize="30"
                                   FontWeight="Bold"/>
                        <TextBlock Text="View, track and manage all received payments"
                                   Foreground="#6B7280"/>
                    </StackPanel>

                    <Button Grid.Column="1"
                            Content="+ Add Payment"
                            Height="40"
                            Padding="18,0"
                            CornerRadius="12"
                            Background="#2563EB"
                            Foreground="White"
                            Click="OpenAddPaymentModal"/>
                </Grid>

                <!-- SUMMARY -->
                <Grid ColumnSpacing="16">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition/>
                        <ColumnDefinition/>
                    </Grid.ColumnDefinitions>

                    <Border Background="White" CornerRadius="16" Padding="20">
                        <StackPanel>
                            <TextBlock Text="Total Received" Foreground="#64748B"/>
                            <TextBlock x:Name="TotalReceivedText"
                   Text="â‚¹ 0"
                   FontSize="24"
                   FontWeight="Bold"
                   Foreground="#15803D"/>
                        </StackPanel>
                    </Border>

                    <Border Grid.Column="1" Background="White" CornerRadius="16" Padding="20">
                        <StackPanel>
                            <TextBlock Text="Pending Amount" Foreground="#64748B"/>
                            <TextBlock x:Name="PendingAmountText"
                   Text="â‚¹ 0"
                   FontSize="24"
                   FontWeight="Bold"
                   Foreground="#B45309"/>
                        </StackPanel>
                    </Border>

                </Grid>

                <!-- ================= FILTERS ================= -->
                <Border Background="White" CornerRadius="16" Padding="16">
                    <Grid ColumnSpacing="16">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <!-- Search -->
                            <ColumnDefinition Width="180"/>
                            <!-- Date -->
                            <ColumnDefinition Width="160"/>
                            <!-- Payment Mode -->
                            <ColumnDefinition Width="Auto"/>
                            <!-- Clear Button -->
                        </Grid.ColumnDefinitions>

                        <!-- SEARCH BOX -->
                        <Grid>
                            <TextBox Height="40"
                     Padding="36,0,12,0"
                     CornerRadius="12"
                     PlaceholderText="Search customer / invoice"
                     FontSize="14"/>
                            <SymbolIcon Symbol="Find"
                        Margin="12,0,0,0"
                        VerticalAlignment="Center"
                        Foreground="#64748B"
                        IsHitTestVisible="False"/>
                        </Grid>

                        <!-- DATE PICKER -->
                        <CalendarDatePicker Grid.Column="1"
                            Height="40"
                            CornerRadius="12"
                            PlaceholderText="Select date"/>

                        <!-- PAYMENT MODE -->
                        <ComboBox Grid.Column="2"
                  Height="40"
                  CornerRadius="12"
                  SelectedIndex="0">
                            <ComboBoxItem Content="All"/>
                            <ComboBoxItem Content="Cash"/>
                            <ComboBoxItem Content="Card"/>
                            <ComboBoxItem Content="Online"/>
                        </ComboBox>

                        <!-- CLEAR BUTTON -->
                        <Button Grid.Column="3"
                Content="Clear"
                Height="40"
                Padding="18,0"
                CornerRadius="12"
                Background="#E5E7EB"
                Foreground="#111827"
                FontWeight="SemiBold"/>
                    </Grid>
                </Border>


                <!-- ================= PAYMENTS TABLE ================= -->
                <Border Background="White" CornerRadius="16" Padding="16">
                    <ScrollViewer HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Disabled">
                        <Grid MinWidth="900">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <!-- Header -->
                                <RowDefinition Height="*"/>
                                <!-- Rows -->
                            </Grid.RowDefinitions>

                            <!-- ================= TABLE HEADER ================= -->
                            <Grid Background="#F1F5F9" Padding="12" CornerRadius="12" Grid.Row="0">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="2*"/>
                                    <!-- Payment ID -->
                                    <ColumnDefinition Width="3*"/>
                                    <!-- Customer -->
                                    <ColumnDefinition Width="2*"/>
                                    <!-- Date -->
                                    <ColumnDefinition Width="3*"/>
                                    <!-- Amount (wider) -->
                                    <ColumnDefinition Width="1.5*"/>
                                    <!-- Mode (smaller) -->
                                    <ColumnDefinition Width="2*"/>
                                    <!-- Status -->
                                    <ColumnDefinition Width="2*"/>
                                    <!-- Actions -->
                                </Grid.ColumnDefinitions>

                                <TextBlock Text="Payment ID" FontWeight="Bold" VerticalAlignment="Center"/>
                                <TextBlock Grid.Column="1" Text="Customer" FontWeight="Bold" VerticalAlignment="Center"/>
                                <TextBlock Grid.Column="2" Text="Date" FontWeight="Bold" VerticalAlignment="Center"/>
                                <TextBlock Grid.Column="3" Text="Amount" FontWeight="Bold" HorizontalAlignment="Right" VerticalAlignment="Center" TextTrimming="CharacterEllipsis"/>
                                <TextBlock Grid.Column="4" Text="Mode" FontWeight="Bold" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                <TextBlock Grid.Column="5" Text="Status" FontWeight="Bold" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                <TextBlock Grid.Column="6" Text="Actions" FontWeight="Bold" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                            </Grid>

                            <!-- TABLE ROWS -->
                            <ItemsControl Grid.Row="1" ItemsSource="{x:Bind Payments}">
                                <ItemsControl.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <StackPanel/>
                                    </ItemsPanelTemplate>
                                </ItemsControl.ItemsPanel>

                                <ItemsControl.ItemTemplate>
                                    <DataTemplate x:DataType="local:PaymentModel">
                                        <Grid Padding="12">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="2*"/>
                                                <!-- Payment ID -->
                                                <ColumnDefinition Width="3*"/>
                                                <!-- Customer -->
                                                <ColumnDefinition Width="2*"/>
                                                <!-- Date -->
                                                <ColumnDefinition Width="2*"/>
                                                <!-- Amount -->
                                                <ColumnDefinition Width="2*"/>
                                                <!-- Mode -->
                                                <ColumnDefinition Width="2*"/>
                                                <!-- Status -->
                                                <ColumnDefinition Width="3*"/>
                                                <!-- Actions -->
                                            </Grid.ColumnDefinitions>

                                            <!-- PAYMENT DATA -->
                                            <TextBlock Text="{x:Bind PaymentId}" FontWeight="SemiBold" VerticalAlignment="Center"/>
                                            <TextBlock Grid.Column="1" Text="{x:Bind Customer}" VerticalAlignment="Center"/>
                                            <TextBlock Grid.Column="2" Text="{x:Bind FormattedDate}" Foreground="#64748B" VerticalAlignment="Center"/>

                                            <!-- Amount and Mode Proper Alignment -->
                                            <TextBlock Grid.Column="3" Text="{x:Bind FormattedAmount}" HorizontalAlignment="Right" FontWeight="Bold" Foreground="#15803D" VerticalAlignment="Center"/>
                                            <TextBlock Grid.Column="4" Text="{x:Bind Mode}" HorizontalAlignment="Center" VerticalAlignment="Center"/>

                                            <!-- STATUS -->
                                            <Border Grid.Column="5"
                                    Padding="6,3"
                                    CornerRadius="12"
                                    HorizontalAlignment="Center"
                                    VerticalAlignment="Center"
                                    Background="{x:Bind Status, Converter={StaticResource StatusBg}}">
                                                <TextBlock Text="{x:Bind Status}"
                                           FontSize="12"
                                           FontWeight="SemiBold"
                                           HorizontalAlignment="Center"
                                           VerticalAlignment="Center"
                                           Foreground="{x:Bind Status, Converter={StaticResource StatusFg}}"/>
                                            </Border>

                                            <!-- ACTION BUTTONS -->
                                            <StackPanel Grid.Column="6"
                                        Orientation="Horizontal"
                                        Spacing="8"
                                        HorizontalAlignment="Center"
                                        VerticalAlignment="Center">
                                                <!-- Share -->
                                                <Button Width="32" Height="32" Padding="0" FontSize="16" FontFamily="Segoe UI Emoji"
                                        Content="ðŸ”—" Background="#E5E7EB" CornerRadius="8"
                                        ToolTipService.ToolTip="Share Payment"/>

                                                <!-- Edit -->
                                                <Button Width="32" Height="32" Padding="0" FontSize="16" FontFamily="Segoe UI Emoji"
                                        Content="âœï¸" Background="#E5E7EB" CornerRadius="8"
                                        ToolTipService.ToolTip="Edit Payment"/>

                                                <!-- Delete -->
                                                <Button Width="32" Height="32" Padding="0" FontSize="16" FontFamily="Segoe UI Emoji"
                                        Content="ðŸ—‘ï¸" Background="#FEE2E2" CornerRadius="8"
                                        ToolTipService.ToolTip="Delete Payment"/>
                                            </StackPanel>
                                        </Grid>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </Grid>
                    </ScrollViewer>
                </Border>


            </StackPanel>
        </ScrollViewer>

        <!-- ================= ADD PAYMENT MODAL ================= -->
        <Grid x:Name="AddPaymentModal"
      Visibility="Collapsed"
      Background="#80000000">

            <Border Width="460"
            Background="White"
            CornerRadius="16"
            Padding="24"
            HorizontalAlignment="Center"
            VerticalAlignment="Center">

                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel Spacing="16">

                        <!-- Modal Title -->
                        <TextBlock Text="Add Payment"
                           FontSize="18"
                           FontWeight="Bold"/>

                        <!-- Customer Name (Mandatory) -->
                        <StackPanel>
                            <TextBlock Text="Customer Name *"
                               Foreground="Red"
                               FontSize="12"
                               Margin="0,0,0,4"/>
                            <TextBox x:Name="TxtCustomer"
                             Height="40"
                             CornerRadius="12"
                             PlaceholderText="Enter customer name"/>
                        </StackPanel>

                        <!-- Amount (Mandatory) -->
                        <StackPanel>
                            <TextBlock Text="Amount *"
                               Foreground="Red"
                               FontSize="12"
                               Margin="0,0,0,4"/>
                            <TextBox x:Name="TxtPaymentAmount"
                             Height="40"
                             CornerRadius="12"
                             PlaceholderText="Enter amount"/>
                        </StackPanel>

                        <!-- Payment Mode (Mandatory) -->
                        <StackPanel>
                            <TextBlock Text="Payment Mode *"
                               Foreground="Red"
                               FontSize="12"
                               Margin="0,0,0,4"/>
                            <ComboBox x:Name="CmbPaymentMode"
                              Height="40"
                              CornerRadius="12"
                              SelectedIndex="0">
                                <ComboBoxItem Content="Cash"/>
                                <ComboBoxItem Content="Card"/>
                                <ComboBoxItem Content="Online"/>
                                <ComboBoxItem Content="UPI"/>
                            </ComboBox>
                        </StackPanel>

                        <!-- Payment Date -->
                        <StackPanel>
                            <TextBlock Text="Payment Date"
                               Foreground="#64748B"
                               FontSize="12"
                               Margin="0,0,0,4"/>
                            <CalendarDatePicker x:Name="DpPaymentDate"
                                        Height="40"
                                        CornerRadius="12"/>
                        </StackPanel>

                        <!-- Payment Status -->
                        <StackPanel>
                            <TextBlock Text="Status"
                               Foreground="#64748B"
                               FontSize="12"
                               Margin="0,0,0,4"/>
                            <ComboBox x:Name="CmbPaymentStatus"
                              Height="40"
                              CornerRadius="12"
                              SelectedIndex="0">
                                <ComboBoxItem Content="Paid"/>
                                <ComboBoxItem Content="Pending"/>
                                <ComboBoxItem Content="Refunded"/>
                            </ComboBox>
                        </StackPanel>

                        <!-- Notes -->
                        <StackPanel>
                            <TextBlock Text="Notes"
                               Foreground="#64748B"
                               FontSize="12"
                               Margin="0,0,0,4"/>
                            <TextBox x:Name="TxtPaymentNotes"
                             Height="70"
                             AcceptsReturn="True"
                             TextWrapping="Wrap"
                             CornerRadius="12"
                             PlaceholderText="Optional notes"/>
                        </StackPanel>

                        <!-- Buttons -->
                        <StackPanel Orientation="Horizontal"
                            HorizontalAlignment="Right"
                            Spacing="12"
                            Margin="0,16,0,0">
                            <Button Content="Cancel"
                            Width="100"
                            CornerRadius="12"
                            Click="BtnCancelAddPayment_Click"/>
                            <Button Content="Save Payment"
                            Width="140"
                            Background="#2563EB"
                            Foreground="White"
                            CornerRadius="12"
                            Click="BtnSavePayment_Click"/>
                        </StackPanel>

                    </StackPanel>
                </ScrollViewer>
            </Border>
        </Grid>


    </Grid>
</Page>
