<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="App_3.Views.PartiesPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:models="using:App_3.Models"
    xmlns:controls="using:Microsoft.UI.Xaml.Controls"
    Background="#F5F7FA">

    <Grid>

        <!-- ================= EMPTY STATE ================= -->
        <Grid x:Name="EmptyState"
      Visibility="Visible"
      HorizontalAlignment="Stretch"
      VerticalAlignment="Stretch"
      Background="#F5F7FA">


            <StackPanel HorizontalAlignment="Center"
                        VerticalAlignment="Center"
                        Width="420"
                        Spacing="18">

                <Border Width="96" Height="96"
                        CornerRadius="24"
                        Background="#E0F2FE"
                        HorizontalAlignment="Center">
                    <SymbolIcon Symbol="Contact"
                                Width="40"
                                Height="40"
                                Foreground="#0284C7"
                                HorizontalAlignment="Center"
                                VerticalAlignment="Center"/>
                </Border>

                <TextBlock Text="No parties added yet"
                           FontSize="22"
                           FontWeight="SemiBold"
                           TextAlignment="Center"/>

                <TextBlock Text="Add customers or suppliers to manage invoices and payments"
                           FontSize="14"
                           Foreground="#64748B"
                           TextAlignment="Center"
                           TextWrapping="Wrap"/>

                <Button Content="+ Add Party"
                        Height="48"
                        FontSize="16"
                        CornerRadius="12"
                        Background="#0284C7"
                        Foreground="White"
                        Click="EmptyStateAddParty_Click"/>
            </StackPanel>
        </Grid>

        <!-- ================= MAIN SCROLLABLE CONTENT ================= -->
        <ScrollViewer x:Name="MainContent"
              Visibility="Collapsed">
            <StackPanel Padding="24" Spacing="16">

                <!-- ================= PAGE HEADER ================= -->
                <Grid Padding="8">

                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <!-- LEFT : TITLE -->
                    <StackPanel>
                        <TextBlock Text="Parties"
                   FontSize="24"
                   FontWeight="Bold"
                   Foreground="#0F172A"/>

                        <TextBlock Text="Manage customers and suppliers"
                   FontSize="13"
                   Foreground="#64748B"
                   Margin="0,4,0,0"/>
                    </StackPanel>

                    <!-- RIGHT : ACTIONS -->
                    <StackPanel Grid.Column="1"
                Orientation="Horizontal"
                Spacing="10"
                VerticalAlignment="Center">

                        <!-- Export -->
                        <Button Content="Export CSV"
                Background="#F1F5F9"
                Foreground="#0F172A"
                Padding="12,6"
                CornerRadius="8"/>

                        <!-- Add Customer -->
                        <Button Content="+ Add Customer"
                Background="#4C6FFF"
                Foreground="White"
                Padding="14,6"
                CornerRadius="8"
                Click="OpenCustomerPopup_Click"/>

                        <!-- Add Supplier -->
                        <Button Content="+ Add Supplier"
                Background="#EEF2FF"
                Foreground="#1E3A8A"
                Padding="14,6"
                CornerRadius="8"
                Click="OpenSupplierPopup_Click"/>

                    </StackPanel>
                </Grid>


                <!-- ================= CUSTOMER / SUPPLIER TOGGLE ================= -->
                <Border Background="#E5E7EB"
        CornerRadius="10"
        Padding="2"
        HorizontalAlignment="Left">

                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <!-- CUSTOMER -->
                        <Button x:Name="CustomerToggle"
                Grid.Column="0"
                Content="Customer"
                Height="32"
                Background="#4C6FFF"
                Foreground="White"
                FontWeight="SemiBold"
                CornerRadius="8"
                BorderThickness="0"
                Click="CustomerToggle_Click"/>

                        <!-- SUPPLIER -->
                        <Button x:Name="SupplierToggle"
                Grid.Column="1"
                Content="Supplier"
                Height="32"
                Background="Transparent"
                Foreground="#334155"
                FontWeight="SemiBold"
                CornerRadius="8"
                BorderThickness="0"
                Click="SupplierToggle_Click"/>

                    </Grid>
                </Border>


                <!-- ================= METRICS ROW ================= -->
                <Grid ColumnSpacing="12"
      RowSpacing="12"
      HorizontalAlignment="Stretch">

                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <!-- TOTAL PARTIES -->
                    <Border Grid.Column="0"
            Background="White"
            CornerRadius="12"
            Padding="16"
            MinHeight="96">
                        <StackPanel Spacing="6">
                            <TextBlock Text="Total Parties"
                       FontSize="12"
                       Foreground="#64748B"/>

                            <TextBlock x:Name="TotalPartiesText"
                       Text="1,248"
                       FontSize="24"
                       FontWeight="Bold"
                       Foreground="#0F172A"/>

                            <TextBlock Text="+18 today"
                       FontSize="11"
                       Foreground="#10B981"/>
                        </StackPanel>
                    </Border>

                    <!-- ACTIVE -->
                    <Border Grid.Column="1"
            Background="White"
            CornerRadius="12"
            Padding="16"
            MinHeight="96">
                        <StackPanel Spacing="6">
                            <TextBlock Text="Active"
                       FontSize="12"
                       Foreground="#64748B"/>

                            <TextBlock x:Name="ActiveText"
                       Text="1,100"
                       FontSize="24"
                       FontWeight="Bold"
                       Foreground="#0F172A"/>

                            <TextBlock Text="+12 today"
                       FontSize="11"
                       Foreground="#10B981"/>
                        </StackPanel>
                    </Border>

                    <!-- INACTIVE -->
                    <Border Grid.Column="2"
            Background="White"
            CornerRadius="12"
            Padding="16"
            MinHeight="96">
                        <StackPanel Spacing="6">
                            <TextBlock Text="Inactive"
                       FontSize="12"
                       Foreground="#64748B"/>

                            <TextBlock x:Name="InactiveText"
                       Text="148"
                       FontSize="24"
                       FontWeight="Bold"
                       Foreground="#0F172A"/>

                            <TextBlock Text="—"
                       FontSize="11"
                       Foreground="#94A3B8"/>
                        </StackPanel>
                    </Border>

                </Grid>


                <!-- ================= SEARCH + FILTER ================= -->
                <Border Background="White" CornerRadius="12" Padding="12">
                    <Grid x:Name="SearchFilterPanel" MaxWidth="760" HorizontalAlignment="Left" VerticalAlignment="Center" ColumnSpacing="12">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="2*"/>
                            <!-- Search Box -->
                            <ColumnDefinition Width="1*"/>
                            <!-- Status Filter -->
                            <ColumnDefinition Width="1*"/>
                            <!-- Sort Filter -->
                            <ColumnDefinition Width="Auto"/>
                            <!-- Reset Button -->
                        </Grid.ColumnDefinitions>

                        <!-- SEARCH BOX -->
                        <Grid MinWidth="200" MaxWidth="300" Grid.Column="0">
                            <TextBox x:Name="SearchBox"
                     PlaceholderText="Search by name, phone or email…"
                     Padding="36,10,12,10"
                     CornerRadius="8"
                     FontSize="14"
                     Height="40"/>
                            <SymbolIcon Symbol="Find"
                        Foreground="#64748B"
                        Width="18"
                        Height="18"
                        Margin="12,0,0,0"
                        VerticalAlignment="Center"
                        HorizontalAlignment="Left"
                        IsHitTestVisible="False"/>
                        </Grid>

                        <!-- STATUS FILTER -->
                        <ComboBox x:Name="StatusFilter"
                  Width="160"
                  Height="40"
                  CornerRadius="8"
                  FontSize="14"
                  Grid.Column="1">
                            <ComboBoxItem Content="All" IsSelected="True"/>
                            <ComboBoxItem Content="Active"/>
                            <ComboBoxItem Content="Inactive"/>
                        </ComboBox>

                        <!-- SORT FILTER -->
                        <ComboBox x:Name="SortFilter"
                  Width="160"
                  Height="40"
                  CornerRadius="8"
                  FontSize="14"
                  Grid.Column="2">
                            <ComboBoxItem Content="Newest" IsSelected="True"/>
                            <ComboBoxItem Content="Oldest"/>
                        </ComboBox>

                        <!-- RESET BUTTON -->
                        <Button Content="Reset"
                Width="Auto"
                MinWidth="64"
                Height="40"
                CornerRadius="8"
                Grid.Column="3"/>
                    </Grid>
                </Border>


                <!-- ================= LEFT + RIGHT GRID ================= -->
                <Grid ColumnSpacing="16">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="4*"/>
                        <ColumnDefinition Width="360"/>
                    </Grid.ColumnDefinitions>


                    <!-- ================= LEFT SIDE ================= -->
                    <Grid Grid.Column="0">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <!-- Table Header -->
                            <RowDefinition Height="*"/>
                            <!-- List -->
                        </Grid.RowDefinitions>

                        <!-- TABLE HEADER -->
                        <Grid Padding="12,8" Background="#F1F5F9">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="3*"/>
                                <!-- Party Name -->
                                <ColumnDefinition Width="2*"/>
                                <!-- Phone -->
                                <ColumnDefinition Width="2*"/>
                                <!-- Balance -->
                                <ColumnDefinition Width="1.5*"/>
                                <!-- Status -->
                                <ColumnDefinition Width="48"/>
                                <!-- Actions -->
                            </Grid.ColumnDefinitions>

                            <TextBlock Text="Party Name" FontWeight="SemiBold" VerticalAlignment="Center"/>
                            <TextBlock Text="Phone" Grid.Column="1" FontWeight="SemiBold" VerticalAlignment="Center"/>
                            <TextBlock Text="Balance" Grid.Column="2" FontWeight="SemiBold" HorizontalAlignment="Right" VerticalAlignment="Center"/>
                            <TextBlock Text="Status" Grid.Column="3" FontWeight="SemiBold" HorizontalAlignment="Left" VerticalAlignment="Center"/>
                        </Grid>

                        <!-- LIST + EMPTY OVERLAY -->
                        <Grid Grid.Row="1">

                            <!-- PARTIES LIST -->
                            <ListView x:Name="PartiesList"
                  SelectionMode="Single"
                  IsItemClickEnabled="True"
                  Margin="0">

                                <ListView.ItemTemplate>
                                    <DataTemplate>
                                        <Grid Padding="12,8" ColumnSpacing="8">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="3*"/>
                                                <ColumnDefinition Width="2*"/>
                                                <ColumnDefinition Width="2*"/>
                                                <ColumnDefinition Width="1.5*"/>
                                                <ColumnDefinition Width="48"/>
                                            </Grid.ColumnDefinitions>

                                            <!-- Party Name -->
                                            <TextBlock Text="{Binding Name}" FontWeight="SemiBold" VerticalAlignment="Center" TextTrimming="CharacterEllipsis"/>

                                            <!-- Phone -->
                                            <TextBlock Text="{Binding Phone}" Grid.Column="1" VerticalAlignment="Center" TextTrimming="CharacterEllipsis"/>

                                            <!-- Balance -->
                                            <TextBlock Text="{Binding Balance}" Grid.Column="2" HorizontalAlignment="Right" VerticalAlignment="Center"/>

                                            <!-- Status -->
                                            <Border Grid.Column="3"
                                Background="{Binding StatusColor}"
                                CornerRadius="10"
                                Padding="6,2"
                                HorizontalAlignment="Left"
                                VerticalAlignment="Center">
                                                <TextBlock Text="{Binding Status}" Foreground="White" FontSize="12"/>
                                            </Border>

                                            <!-- Actions -->
                                            <Button Grid.Column="4"
                                Content="⋮"
                                Width="36"
                                Height="28"
                                HorizontalAlignment="Center"
                                VerticalAlignment="Center">
                                                <Button.Flyout>
                                                    <MenuFlyout>
                                                        <MenuFlyoutItem Text="Edit Party"/>
                                                        <MenuFlyoutItem Text="View Ledger"/>
                                                        <MenuFlyoutItem Text="Delete" Foreground="Red"/>
                                                    </MenuFlyout>
                                                </Button.Flyout>
                                            </Button>

                                            <!-- Divider -->
                                            <Border Grid.ColumnSpan="5"
                                BorderBrush="#E5E7EB"
                                BorderThickness="0,0,0,1"
                                VerticalAlignment="Bottom"/>
                                        </Grid>
                                    </DataTemplate>
                                </ListView.ItemTemplate>
                            </ListView>

                        </Grid>
                    </Grid>


                    <!-- ================= RIGHT SIDE : PARTY DETAILS ================= -->
                    <Border Grid.Column="1" Background="White" CornerRadius="12" Padding="16">
                        <ScrollViewer VerticalScrollBarVisibility="Auto">
                            <StackPanel Spacing="16">

                                <!-- Party Header Card -->
                                <Border Background="#F8FAFC" CornerRadius="10" Padding="12">
                                    <StackPanel>
                                        <TextBlock Text="{Binding SelectedParty.Name}" FontSize="18" FontWeight="Bold" TextTrimming="CharacterEllipsis"/>
                                        <StackPanel Orientation="Horizontal" Spacing="6" Margin="0,4,0,0">
                                            <Border Background="#DBEAFE" CornerRadius="8" Padding="6,2">
                                                <TextBlock Text="{Binding SelectedParty.Type}" FontSize="12"/>
                                            </Border>
                                            <Border Background="{Binding SelectedParty.StatusColor}" CornerRadius="8" Padding="6,2">
                                                <TextBlock Text="{Binding SelectedParty.Status}" FontSize="12" Foreground="White"/>
                                            </Border>
                                        </StackPanel>
                                    </StackPanel>
                                </Border>

                                <!-- Financial Summary Card -->
                                <Border Background="#F0F9FF" CornerRadius="10" Padding="12">
                                    <StackPanel Spacing="6">
                                        <TextBlock Text="Outstanding Balance" Foreground="#64748B"/>
                                        <TextBlock Text="{Binding SelectedParty.Outstanding}" FontSize="22" FontWeight="Bold" Foreground="{Binding SelectedParty.BalanceColor}"/>
                                        <TextBlock Text="Total Sales: ₹{Binding SelectedParty.TotalSales}" FontSize="12" Foreground="#475569"/>
                                    </StackPanel>
                                </Border>

                                <!-- Quick Actions -->
                                <StackPanel Spacing="8">
                                    <Button Content="Create Invoice" Background="#4C6FFF" Foreground="White" CornerRadius="8"/>
                                    <Button Content="Receive Payment" Background="#E0E7FF" CornerRadius="8"/>
                                    <Button Content="View Ledger" Background="#E0E7FF" CornerRadius="8"/>
                                </StackPanel>

                                <!-- Recent Activity -->
                                <StackPanel>
                                    <TextBlock Text="Recent Activity" FontWeight="SemiBold"/>
                                    <TextBlock Text="Last Invoice: 12 Aug 2025" FontSize="12" Foreground="#64748B"/>
                                    <TextBlock Text="Last Payment: ₹4,500" FontSize="12" Foreground="#64748B"/>
                                </StackPanel>

                            </StackPanel>
                        </ScrollViewer>
                    </Border>
                </Grid>


            </StackPanel>
        </ScrollViewer>

        <!-- ================= ADD PARTY POPUP ================= -->
        <Grid x:Name="AddPartyOverlay"
      Background="#80000000"
      Visibility="Collapsed"
      HorizontalAlignment="Stretch"
      VerticalAlignment="Stretch">

            <Border Width="480"
            MaxHeight="720"
            Background="White"
            CornerRadius="16"
            Padding="24"
            HorizontalAlignment="Center"
            VerticalAlignment="Center">

                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel Spacing="16">

                        <!-- HEADER -->
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <TextBlock x:Name="PopupTitle"
                               Text="Add Party"
                               FontSize="18"
                               FontWeight="Bold"/>

                            <Button Content="✕"
                            Grid.Column="1"
                            Width="32"
                            Height="32"
                            CornerRadius="8"
                            Click="CloseAddParty_Click"/>
                        </Grid>

                        <!-- ================= BASIC DETAILS ================= -->
                        <TextBlock Text="Basic Details"
                           FontWeight="SemiBold"
                           FontSize="14"/>

                        <!-- NAME -->
                        <StackPanel>
                            <TextBlock Text="Name *"
                               Foreground="Red"
                               FontSize="12"
                               Margin="0,0,0,4"/>
                            <TextBox x:Name="PartyNameBox"
                             Height="40"
                             CornerRadius="8"
                             PlaceholderText="Enter customer / supplier name"/>
                        </StackPanel>

                        <!-- PHONE -->
                        <StackPanel>
                            <TextBlock Text="Phone"
                               FontSize="12"
                               Foreground="#64748B"
                               Margin="0,0,0,4"/>
                            <TextBox x:Name="PhoneBox"
                             Height="40"
                             CornerRadius="8"
                             InputScope="TelephoneNumber"
                             PlaceholderText="Phone (optional)"/>
                        </StackPanel>

                        <!-- EMAIL -->
                        <StackPanel>
                            <TextBlock Text="Email"
                               FontSize="12"
                               Foreground="#64748B"
                               Margin="0,0,0,4"/>
                            <TextBox x:Name="EmailBox"
                             Height="40"
                             CornerRadius="8"
                             PlaceholderText="Email (optional)"/>
                        </StackPanel>

                        <!-- ADDRESS -->
                        <StackPanel>
                            <TextBlock Text="Billing Address *"
                               Foreground="Red"
                               FontSize="12"
                               Margin="0,0,0,4"/>
                            <TextBox x:Name="BillingAddressBox"
                             Height="90"
                             AcceptsReturn="True"
                             TextWrapping="Wrap"
                             CornerRadius="8"
                             PlaceholderText="Enter billing address"/>
                        </StackPanel>

                        <!-- ================= FINANCIAL DETAILS ================= -->
                        <TextBlock Text="Financial Details (Optional)"
                           FontWeight="SemiBold"
                           FontSize="14"
                           Margin="0,8,0,0"/>

                        <!-- GST -->
                        <StackPanel>
                            <TextBlock Text="GST Number"
                               FontSize="12"
                               Foreground="#64748B"
                               Margin="0,0,0,4"/>
                            <TextBox x:Name="GSTBox"
                             Height="40"
                             CornerRadius="8"
                             PlaceholderText="GSTIN (optional)"/>
                        </StackPanel>

                        <!-- OPENING BALANCE -->
                        <StackPanel>
                            <TextBlock Text="Opening Balance"
                               FontSize="12"
                               Foreground="#64748B"
                               Margin="0,0,0,4"/>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <TextBlock Text="₹"
                                   VerticalAlignment="Center"
                                   Margin="8,0,4,0"
                                   Foreground="#475569"/>

                                <TextBox x:Name="OpeningBalanceBox"
                                 Grid.Column="1"
                                 Height="40"
                                 CornerRadius="8"
                                 InputScope="Number"
                                 PlaceholderText="0.00"/>
                            </Grid>
                        </StackPanel>

                        <!-- ================= BANK DETAILS (SUPPLIER) ================= -->
                        <StackPanel x:Name="BankSection"
                            Visibility="Collapsed"
                            Spacing="12"
                            Margin="0,8,0,0">

                            <TextBlock Text="Bank Details (Supplier)"
                               FontWeight="SemiBold"
                               FontSize="14"/>

                            <TextBox x:Name="BankNameBox"
                             Height="40"
                             CornerRadius="8"
                             PlaceholderText="Bank Name *"/>

                            <TextBox x:Name="AccountNumberBox"
                             Height="40"
                             CornerRadius="8"
                             InputScope="Number"
                             PlaceholderText="Account Number *"/>

                            <TextBox x:Name="IFSCBox"
                             Height="40"
                             CornerRadius="8"
                             PlaceholderText="IFSC Code *"/>

                            <TextBox x:Name="UPIBox"
                             Height="40"
                             CornerRadius="8"
                             PlaceholderText="UPI ID (optional)"/>

                            <TextBox x:Name="BranchBox"
                             Height="40"
                             CornerRadius="8"
                             PlaceholderText="Branch (optional)"/>
                        </StackPanel>

                        <!-- ================= ACTIONS ================= -->
                        <StackPanel Orientation="Horizontal"
                            HorizontalAlignment="Right"
                            Spacing="12"
                            Margin="0,16,0,0">

                            <Button Content="Cancel"
                            Width="100"
                            Click="CloseAddParty_Click"/>

                            <Button Content="Save Party"
                            Width="140"
                            Background="#2563EB"
                            Foreground="White"/>
                        </StackPanel>

                    </StackPanel>
                </ScrollViewer>
            </Border>
        </Grid>


    </Grid>
</Page>
