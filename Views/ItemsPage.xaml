<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="App_3.Views.ItemsPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:models="using:App_3.Models"
    Background="#F3F4F6">

    <Grid>

        <!-- ================= MAIN CONTENT ================= -->
        <ScrollViewer>
            <StackPanel Padding="24" Spacing="20">

                <!-- HEADER -->
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <StackPanel>
                        <TextBlock Text="Items"
                                   FontSize="28"
                                   FontWeight="Bold"
                                   Foreground="#0F172A"/>
                        <TextBlock Text="Manage products, stock &amp; pricing"
                                   FontSize="13"
                                   Foreground="#64748B"
                                   Margin="0,6,0,0"/>
                    </StackPanel>

                    <!-- BULK IMPORT / EXPORT + ADD ITEM -->
                    <StackPanel Grid.Column="1"
                                Orientation="Horizontal"
                                Spacing="8">

                        <Button Content="â¬† Import"
                                Padding="12,8"
                                CornerRadius="8"
                                ToolTipService.ToolTip="Import items from CSV/Excel"/>

                        <Button Content="â¬‡ Export"
                                Padding="12,8"
                                CornerRadius="8"
                                ToolTipService.ToolTip="Export items to Excel"/>

                        <Button Content="+ Add Item"
                                Padding="14,8"
                                Background="#2563EB"
                                Foreground="White"
                                CornerRadius="8"
                                Click="OpenAddItemPopup"/>
                    </StackPanel>
                </Grid>

                <!-- SEARCH & FILTER -->
                <Border Background="White"
                        CornerRadius="8"
                        Padding="14">

                    <StackPanel Orientation="Horizontal" Spacing="12" MaxWidth="600">

                        <!-- SEARCH -->
                        <Grid Width="260">
                            <TextBox x:Name="SearchBox"
                                     PlaceholderText="Search item name or code"
                                     Padding="36,8,10,8"
                                     CornerRadius="8"/>
                            <SymbolIcon Symbol="Find"
                                        Foreground="#64748B"
                                        Width="16"
                                        Height="16"
                                        Margin="12,0,0,0"
                                        VerticalAlignment="Center"
                                        HorizontalAlignment="Left"
                                        IsHitTestVisible="False"/>
                        </Grid>

                        <!-- FILTER -->
                        <ComboBox Width="160"
                                  PlaceholderText="Stock Status"
                                  CornerRadius="8">
                            <ComboBoxItem Content="All"/>
                            <ComboBoxItem Content="In Stock"/>
                            <ComboBoxItem Content="Low Stock"/>
                            <ComboBoxItem Content="Out of Stock"/>
                        </ComboBox>

                    </StackPanel>
                </Border>

                <!-- ITEMS TABLE -->
                <Border Background="White"
                        CornerRadius="8"
                        Padding="14">

                    <StackPanel>

                        <!-- HEADER ROW -->
                        <Grid Padding="6">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="2*"/>
                                <ColumnDefinition/>
                                <ColumnDefinition/>
                                <ColumnDefinition/>
                                <ColumnDefinition/>
                                <ColumnDefinition/>
                                <ColumnDefinition/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <TextBlock Text="Item" FontWeight="SemiBold"/>
                            <TextBlock Text="SKU" Grid.Column="1" FontWeight="SemiBold"/>
                            <TextBlock Text="Sale Price" Grid.Column="2" FontWeight="SemiBold"/>
                            <TextBlock Text="Purchase" Grid.Column="3" FontWeight="SemiBold"/>
                            <TextBlock Text="Stock" Grid.Column="4" FontWeight="SemiBold"/>
                            <TextBlock Text="Unit" Grid.Column="5" FontWeight="SemiBold"/>
                            <TextBlock Text="Status" Grid.Column="6" FontWeight="SemiBold"/>
                            <TextBlock Text="Actions" Grid.Column="7" FontWeight="SemiBold"/>
                        </Grid>

                        <!-- ITEMS -->
                        <ListView x:Name="ItemsList" Margin="0,8,0,0">
                            <ListView.ItemTemplate>
                                <DataTemplate>
                                    <Grid Padding="6">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="2*"/>
                                            <!-- Item Image + Name -->
                                            <ColumnDefinition/>
                                            <!-- SKU -->
                                            <ColumnDefinition/>
                                            <!-- Sale Price -->
                                            <ColumnDefinition/>
                                            <!-- Purchase Price -->
                                            <ColumnDefinition/>
                                            <!-- Stock + Badges -->
                                            <ColumnDefinition/>
                                            <!-- Unit -->
                                            <ColumnDefinition/>
                                            <!-- Status -->
                                            <ColumnDefinition Width="Auto"/>
                                            <!-- Actions -->
                                        </Grid.ColumnDefinitions>

                                        <!-- ITEM IMAGE + NAME -->
                                        <Grid Grid.Column="0">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="36"/>
                                                <!-- Image -->
                                                <ColumnDefinition Width="8"/>
                                                <!-- Spacer -->
                                                <ColumnDefinition Width="*"/>
                                                <!-- Name -->
                                            </Grid.ColumnDefinitions>

                                            <Border Grid.Column="0" Width="36" Height="36" CornerRadius="6" Background="#E5E7EB">
                                                <Image Source="{Binding ImagePath}" Stretch="UniformToFill"/>
                                            </Border>

                                            <TextBlock Grid.Column="2" Text="{Binding Name}" VerticalAlignment="Center"/>
                                        </Grid>

                                        <!-- SKU -->
                                        <TextBlock Text="{Binding SKU}" Grid.Column="1" VerticalAlignment="Center"/>

                                        <!-- Sale Price -->
                                        <TextBlock Text="{Binding SalePrice}" Grid.Column="2" VerticalAlignment="Center"/>

                                        <!-- Purchase Price -->
                                        <TextBlock Text="{Binding PurchasePrice}" Grid.Column="3" VerticalAlignment="Center"/>

                                        <!-- STOCK + BADGES -->
                                        <StackPanel Grid.Column="4" Orientation="Horizontal" Spacing="6" VerticalAlignment="Center">
                                            <TextBlock Text="{Binding StockQty}" VerticalAlignment="Center"/>

                                            <Border Background="#F59E0B"
                            CornerRadius="6"
                            Padding="4,2"
                            Visibility="{Binding IsLowStock}">
                                                <TextBlock Text="LOW" FontSize="11" Foreground="White"/>
                                            </Border>

                                            <Border Background="#EF4444"
                            CornerRadius="6"
                            Padding="4,2"
                            Visibility="{Binding IsOutOfStock}">
                                                <TextBlock Text="OUT" FontSize="11" Foreground="White"/>
                                            </Border>
                                        </StackPanel>

                                        <!-- Unit -->
                                        <TextBlock Text="{Binding Unit}" Grid.Column="5" VerticalAlignment="Center"/>

                                        <!-- STATUS -->
                                        <Border Grid.Column="6"
                        Background="{Binding StatusColor}"
                        CornerRadius="6"
                        Padding="6,2"
                        VerticalAlignment="Center">
                                            <TextBlock Text="{Binding Status}"
                               FontSize="12"
                               Foreground="{Binding StatusTextColor}"
                               VerticalAlignment="Center"/>
                                        </Border>

                                        <!-- ACTIONS -->
                                        <StackPanel Grid.Column="7" Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
                                            <Button Content="âœï¸" Padding="6" CornerRadius="6" Click="EditItem_Click"/>
                                            <Button Content="ðŸ—‘" Padding="6" CornerRadius="6"/>
                                        </StackPanel>
                                    </Grid>
                                </DataTemplate>
                            </ListView.ItemTemplate>
                        </ListView>


                    </StackPanel>
                </Border>

            </StackPanel>
        </ScrollViewer>

        <!-- ================= ADD ITEM POPUP ================= -->
        <Grid x:Name="AddItemOverlay"
              Background="#80000000"
              Visibility="Collapsed"
              HorizontalAlignment="Stretch"
              VerticalAlignment="Stretch">

            <Border Width="450"
                    Background="White"
                    CornerRadius="12"
                    Padding="24"
                    VerticalAlignment="Center"
                    HorizontalAlignment="Center">

                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel Spacing="16">

                        <TextBlock Text="Add Item" FontSize="22" FontWeight="SemiBold"/>

                        <!-- IMAGE UPLOAD -->
                        <StackPanel HorizontalAlignment="Center" Spacing="8">
                            <Border Width="100" Height="100" CornerRadius="12" Background="#E5E7EB">
                                <Image x:Name="AddItemImage" Stretch="UniformToFill"/>
                            </Border>
                            <Button Content="Upload Image" Padding="10,6" CornerRadius="6"/>
                        </StackPanel>

                        <!-- FORM FIELDS -->
                        <StackPanel Spacing="12">
                            <StackPanel>
                                <TextBlock Text="Item Name *" Foreground="Red" FontSize="12"/>
                                <TextBox x:Name="AddItemName" CornerRadius="8"/>
                            </StackPanel>

                            <StackPanel>
                                <TextBlock Text="Sale Price *" Foreground="Red" FontSize="12"/>
                                <TextBox x:Name="AddItemSalePrice" CornerRadius="8"/>
                            </StackPanel>

                            <TextBox x:Name="AddItemSKU" PlaceholderText="Item Code / SKU" CornerRadius="8"/>
                            <TextBox x:Name="AddItemPurchasePrice" PlaceholderText="Purchase Price" CornerRadius="8"/>
                            <TextBox x:Name="AddItemStock" PlaceholderText="Opening Stock" CornerRadius="8"/>

                            <StackPanel>
                                <TextBlock Text="Unit *" Foreground="Red" FontSize="12"/>
                                <ComboBox x:Name="AddItemUnit" CornerRadius="8">
                                    <ComboBoxItem Content="pcs"/>
                                    <ComboBoxItem Content="kg"/>
                                    <ComboBoxItem Content="ltr"/>
                                </ComboBox>
                            </StackPanel>

                            <TextBox x:Name="AddItemTax" PlaceholderText="Tax %" CornerRadius="8"/>
                            <TextBox x:Name="AddItemHSN" PlaceholderText="HSN Code" CornerRadius="8"/>
                            <TextBox x:Name="AddItemDescription"
                                     PlaceholderText="Description"
                                     Height="80"
                                     AcceptsReturn="True"
                                     CornerRadius="8"/>
                        </StackPanel>

                        <!-- ACTION BUTTONS -->
                        <StackPanel Orientation="Horizontal"
                                    HorizontalAlignment="Right"
                                    Spacing="12"
                                    Margin="0,12,0,0">
                            <Button Content="Cancel"
                                    CornerRadius="8"
                                    Width="90"
                                    Click="CloseAddItemPopup"/>
                            <Button Content="Save Item"
                                    Width="110"
                                    Background="#2563EB"
                                    Foreground="White"
                                    CornerRadius="8"
                                    Click="SaveNewItem"/>
                        </StackPanel>

                    </StackPanel>
                </ScrollViewer>
            </Border>
        </Grid>

        <!-- ================= EDIT ITEM POPUP ================= -->
        <Grid x:Name="EditItemOverlay"
              Background="#80000000"
              Visibility="Collapsed"
              HorizontalAlignment="Stretch"
              VerticalAlignment="Stretch">

            <Border Width="450" 
                    Background="White"
                    CornerRadius="12"
                    Padding="24"
                    VerticalAlignment="Center"
                    HorizontalAlignment="Center">

                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel Spacing="16">

                        <TextBlock Text="Edit Item" FontSize="22" FontWeight="SemiBold"/>

                        <!-- IMAGE UPLOAD -->
                        <StackPanel HorizontalAlignment="Center" Spacing="8">
                            <Border Width="100" Height="100" CornerRadius="12" Background="#E5E7EB">
                                <Image x:Name="EditItemImage" Stretch="UniformToFill"/>
                            </Border>
                            <Button Content="Upload Image" Padding="10,6" CornerRadius="6"/>
                        </StackPanel>

                        <!-- FORM FIELDS -->
                        <StackPanel Spacing="12">
                            <StackPanel>
                                <TextBlock Text="Item Name *" Foreground="Red" FontSize="12"/>
                                <TextBox x:Name="EditItemName" CornerRadius="8"/>
                            </StackPanel>

                            <StackPanel>
                                <TextBlock Text="Sale Price *" Foreground="Red" FontSize="12"/>
                                <TextBox x:Name="EditItemSalePrice" CornerRadius="8"/>
                            </StackPanel>

                            <StackPanel>
                                <TextBlock Text="Unit *" Foreground="Red" FontSize="12"/>
                                <ComboBox x:Name="EditItemUnit" CornerRadius="8">
                                    <ComboBoxItem Content="pcs"/>
                                    <ComboBoxItem Content="kg"/>
                                    <ComboBoxItem Content="ltr"/>
                                </ComboBox>
                            </StackPanel>

                            <TextBox x:Name="EditItemSKU" PlaceholderText="Item Code / SKU" CornerRadius="8"/>
                            <TextBox x:Name="EditItemPurchasePrice" PlaceholderText="Purchase Price" CornerRadius="8"/>
                            <TextBox x:Name="EditItemStock" PlaceholderText="Opening Stock" CornerRadius="8"/>
                            <TextBox x:Name="EditItemTax" PlaceholderText="Tax %" CornerRadius="8"/>
                            <TextBox x:Name="EditItemHSN" PlaceholderText="HSN Code" CornerRadius="8"/>
                            <TextBox x:Name="EditItemDescription"
                                     PlaceholderText="Description"
                                     Height="80"
                                     AcceptsReturn="True"
                                     CornerRadius="8"/>
                        </StackPanel>

                        <!-- ACTION BUTTONS -->
                        <StackPanel Orientation="Horizontal"
                                    HorizontalAlignment="Right"
                                    Spacing="12"
                                    Margin="0,12,0,0">
                            <Button Content="Cancel"
                                    CornerRadius="8"
                                    Width="90"
                                    Click="CloseEditItemPopup"/>
                            <Button Content="Update Item"
                                    Width="110"
                                    Background="#2563EB"
                                    Foreground="White"
                                    CornerRadius="8"
                                    Click="UpdateItem"/>
                        </StackPanel>

                    </StackPanel>
                </ScrollViewer>
            </Border>
        </Grid>

    </Grid>
</Page>
